<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vortex: Democratizing Sparse Attention</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React & ReactDOM (Stable 18.2.0) -->
  <script src="https://unpkg.com/react@18.2.0/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js" crossorigin></script>
  
  <!-- Prop-Types (Required for Recharts) -->
  <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>
  
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Recharts (Stable 2.12.7) -->
  <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>

  <style>
    body { font-family: 'Inter', sans-serif; }
    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3b82f6;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body class="bg-slate-50">

  <div id="root" class="min-h-screen flex items-center justify-center">
    <div class="text-slate-400 flex flex-col items-center gap-4">
      <div class="loader"></div>
      <p>Loading Vortex Blog...</p>
    </div>
  </div>

  <script type="text/babel">
    try {
      if (!window.React || !window.ReactDOM || !window.Recharts) {
        throw new Error("External libraries failed to load.");
      }

      const { useState, useEffect } = React;
      const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, Cell } = Recharts;

      // --- Icons ---
      const Icon = ({ name, className }) => {
        const paths = {
          ArrowRight: "M5 12h14M12 5l7 7-7 7",
          Layers: "M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5",
          Cpu: "M12 2v2M12 20v2M2 12h2M20 12h2M5 5h14v14H5zM8.5 8.5h7v7h-7z",
          Zap: "M13 2L3 14h9l-1 8 10-12h-9l1-8z",
          Box: "M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16zM3.27 6.96L12 12.01l8.73-5.05M12 22.08V12",
          Lock: "M19 11H5a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-6a2 2 0 0 0-2-2zm-7-9a6 6 0 0 1 6 6v3h-12v-3a6 6 0 0 1 6-6z",
          AlertTriangle: "M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0zM12 9v4M12 17h.01",
          Code: "M16 18l6-6-6-6M8 6l-6 6 6 6",
          Server: "M2 12h20M2 18h20M2 6h20M6 6v12M18 6v12",
          Database: "M3 6h18M3 12h18M3 18h18",
          GitBranch: "M6 3v12",
          Check: "M20 6L9 17l-5-5",
          User: "M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8z",
          Clock: "M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zM12 6v6l4 2",
          Activity: "M22 12h-4l-3 9L9 3l-3 9H2",
          Brain: "M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 4.44-4zM14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-4.44-4z",
        };
        return (
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
            {paths[name] ? <path d={paths[name]} /> : <circle cx="12" cy="12" r="10"/>}
            {name === 'Check' && <polyline points="20 6 9 17 5 12" />}
            {name === 'GitBranch' && <g><line x1="6" y1="3" x2="6" y2="15"></line><circle cx="18" cy="6" r="3"></circle><circle cx="6" cy="18" r="3"></circle><path d="M18 9a9 9 0 0 1-9 9"></path></g>}
            {name === 'Layers' && <polyline points="2 17 12 22 22 17" />}
            {name === 'Layers' && <polyline points="2 12 12 17 22 12" />}
          </svg>
        );
      };

      // --- Data ---
      const performanceData = [
        { name: 'H100 GPU', baseline: 1.0, vortex: 2.8, gain: '2.8x' },
        { name: 'A40 GPU', baseline: 1.0, vortex: 4.0, gain: '4.0x' },
      ];

      // --- Components ---
      const SectionHeader = ({ title }) => (
        <div className="flex items-center gap-3 mb-6 mt-12">
          <h2 className="text-2xl font-bold text-slate-900 tracking-tight">{title}</h2>
        </div>
      );

      const Callout = ({ title, children, type = "default" }) => {
        const colors = {
          default: "bg-slate-50 border-slate-200 text-slate-700",
          warning: "bg-amber-50 border-amber-200 text-amber-800",
          success: "bg-green-50 border-green-200 text-green-800",
        };
        const icons = {
          default: "Box",
          warning: "AlertTriangle",
          success: "Zap",
        };
        return (
          <div className={`p-6 rounded-lg mb-8 border ${colors[type]}`}>
            <h3 className="font-bold text-sm uppercase tracking-wide mb-3 flex items-center gap-2">
              <Icon name={icons[type]} className="w-4 h-4" /> {title}
            </h3>
            <div className="text-sm leading-relaxed opacity-90">{children}</div>
          </div>
        );
      };

      const SystemDilemma = () => (
        <div className="grid md:grid-cols-2 gap-6 my-8">
          <div className="border border-slate-200 rounded-xl p-6 bg-white hover:shadow-md transition-shadow">
            <div className="w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center mb-4">
              <Icon name="Lock" className="w-5 h-5 text-slate-600" />
            </div>
            <h4 className="font-bold text-slate-900 mb-2">Full Stack Builder</h4>
            <p className="text-xs text-slate-500 mb-4">Tight coupling of algo & kernel.</p>
            <ul className="text-sm text-slate-600 space-y-2">
              <li className="flex gap-2"><span className="text-green-500">✓</span> High Performance</li>
              <li className="flex gap-2"><span className="text-red-500">✗</span> Zero Flexibility</li>
              <li className="flex gap-2"><span className="text-red-500">✗</span> Maintenance Nightmare</li>
            </ul>
          </div>
          <div className="border border-slate-200 rounded-xl p-6 bg-white hover:shadow-md transition-shadow">
            <div className="w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center mb-4">
              <Icon name="Server" className="w-5 h-5 text-slate-600" />
            </div>
            <h4 className="font-bold text-slate-900 mb-2">General Purpose Builder</h4>
            <p className="text-xs text-slate-500 mb-4">Broad platform support.</p>
            <ul className="text-sm text-slate-600 space-y-2">
              <li className="flex gap-2"><span className="text-green-500">✓</span> Stable Platform</li>
              <li className="flex gap-2"><span className="text-red-500">✗</span> Slow Adoption</li>
              <li className="flex gap-2"><span className="text-red-500">✗</span> Limited Algo Support</li>
            </ul>
          </div>
        </div>
      );

      const CoreChallenges = () => (
        <div className="my-10 space-y-4">
          {[
            { title: "Defining what to cache", desc: "How to manage intermediate structures like centroids?", icon: "Database" },
            { title: "Dispatching the right ops", desc: "Coordinating custom ops (mv, topk) with standard kernels.", icon: "GitBranch" },
            { title: "Leveraging Infrastructure", desc: "Plugging into paged attention and memory managers.", icon: "Server" }
          ].map((item, i) => (
            <div key={i} className="flex items-start gap-4 p-4 rounded-lg bg-slate-50 border border-slate-100">
              <div className="bg-white p-2 rounded shadow-sm">
                <Icon name={item.icon} className="w-5 h-5 text-blue-500" />
              </div>
              <div>
                <h4 className="font-bold text-slate-800 text-sm">{item.title}</h4>
                <p className="text-sm text-slate-600">{item.desc}</p>
              </div>
            </div>
          ))}
        </div>
      );

      const VortexArchitectureDiagram = () => (
        <div className="my-10 bg-slate-900 rounded-xl overflow-hidden shadow-2xl ring-1 ring-slate-900/5 text-slate-300">
          <div className="bg-slate-800/50 px-6 py-3 border-b border-slate-700/50 flex justify-between items-center">
              <h3 className="text-sm font-bold text-white uppercase tracking-wide">Vortex Architecture</h3>
              <span className="text-xs font-mono text-blue-400">v1.0</span>
          </div>
          
          <div className="p-8 relative grid gap-6">
            
            {/* Top: PyTorch Interface */}
            <div className="relative z-10">
               <div className="absolute -left-4 top-1/2 -translate-y-1/2 -rotate-90 text-[10px] font-bold text-slate-500 tracking-widest uppercase">User</div>
               <div className="bg-slate-800 border border-slate-600 p-4 rounded-lg">
                  <div className="flex items-center gap-2 mb-2">
                    <Icon name="Code" className="w-4 h-4 text-green-400" />
                    <span className="text-sm font-bold text-slate-100">PyTorch Frontend</span>
                  </div>
                  <p className="text-xs text-slate-400">Write sparse attention logic in Python. Use standard ops.</p>
               </div>
            </div>

            {/* Middle: The Bridge */}
            <div className="flex justify-center -my-3 relative z-0">
               <div className="h-8 w-0.5 bg-gradient-to-b from-slate-600 to-blue-500"></div>
            </div>

            {/* Middle: Vortex Core */}
            <div className="relative z-10">
               <div className="absolute -left-4 top-1/2 -translate-y-1/2 -rotate-90 text-[10px] font-bold text-blue-500 tracking-widest uppercase">Vortex</div>
               <div className="grid grid-cols-2 gap-4">
                  <div className="bg-blue-900/20 border border-blue-500/50 p-4 rounded-lg">
                    <span className="text-xs font-mono text-blue-300 block mb-1">Phase 1</span>
                    <h4 className="font-bold text-white text-sm">forward_cache</h4>
                    <p className="text-[10px] text-slate-400 mt-1">Computes centroids, keys, & layout.</p>
                  </div>
                  <div className="bg-blue-900/20 border border-blue-500/50 p-4 rounded-lg">
                    <span className="text-xs font-mono text-blue-300 block mb-1">Phase 2</span>
                    <h4 className="font-bold text-white text-sm">forward_indexer</h4>
                    <p className="text-[10px] text-slate-400 mt-1">Selects indices (top-K, sampling).</p>
                  </div>
               </div>
            </div>

            {/* Bottom: System */}
            <div className="flex justify-center -my-3 relative z-0">
               <div className="h-8 w-0.5 bg-gradient-to-b from-blue-500 to-slate-600"></div>
            </div>

            <div className="relative z-10">
               <div className="absolute -left-4 top-1/2 -translate-y-1/2 -rotate-90 text-[10px] font-bold text-slate-500 tracking-widest uppercase">System</div>
               <div className="bg-slate-800 border border-slate-600 p-4 rounded-lg flex divide-x divide-slate-700">
                  <div className="flex-1 px-4 text-center">
                     <Icon name="Database" className="w-5 h-5 text-purple-400 mx-auto mb-2" />
                     <h4 className="text-xs font-bold text-slate-300">Memory Manager</h4>
                     <p className="text-[10px] text-slate-500">KV Cache / Paging</p>
                  </div>
                  <div className="flex-1 px-4 text-center">
                     <Icon name="Cpu" className="w-5 h-5 text-green-400 mx-auto mb-2" />
                     <h4 className="text-xs font-bold text-slate-300">Attention Backend</h4>
                     <p className="text-[10px] text-slate-500">CUDA / Triton Kernels</p>
                  </div>
               </div>
            </div>

          </div>
        </div>
      );

      const TensorInterfaceVisual = () => (
        <div className="my-8 p-6 bg-slate-100 rounded-xl border border-slate-200 font-mono text-sm shadow-inner">
          <div className="flex items-center gap-2 mb-4 text-slate-500 text-xs uppercase font-bold tracking-wider">
            <Icon name="Code" className="w-3 h-3" /> The Extended Tensor Abstraction
          </div>
          <div className="text-slate-800">
            <span className="text-purple-600">class</span> <span className="text-yellow-600">VortexTensor</span>(Tensor):<br/>
            &nbsp;&nbsp;<span className="text-slate-500"># Standard PyTorch data</span><br/>
            &nbsp;&nbsp;self.data = data<br/>
            &nbsp;&nbsp;<span className="text-slate-500"># The magic field</span><br/>
            &nbsp;&nbsp;self.<span className="text-blue-600 font-bold">storage_format</span> = format <span className="text-slate-400">// e.g. Flat, Paged, Ragged</span>
          </div>
          <div className="mt-4 pt-4 border-t border-slate-200 text-xs text-slate-500">
            System developers optimize <code>mv(flat, paged)</code>. Users just call <code>mv()</code>.
          </div>
        </div>
      );

      const PerformanceChart = () => (
        <div className="my-10 p-6 bg-white border border-slate-200 rounded-xl shadow-sm">
          <h3 className="text-sm font-bold text-slate-500 uppercase tracking-wide mb-6">Throughput Gain vs. Baseline</h3>
          <div className="h-64 w-full">
            <ResponsiveContainer width="100%" height="100%">
              <BarChart data={performanceData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>
                <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                <XAxis dataKey="name" tick={{fontSize: 12, fill: '#64748b'}} axisLine={false} tickLine={false} />
                <YAxis hide />
                <Tooltip 
                  cursor={{fill: '#f8fafc'}}
                  contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }}
                />
                <Bar dataKey="baseline" name="Baseline" fill="#e2e8f0" radius={[4, 4, 0, 0]} />
                <Bar dataKey="vortex" name="Vortex (Max)" fill="#3b82f6" radius={[4, 4, 0, 0]}>
                  {performanceData.map((entry, index) => (
                    <Cell key={`cell-${index}`} fill={index === 1 ? '#1d4ed8' : '#3b82f6'} />
                  ))}
                </Bar>
              </BarChart>
            </ResponsiveContainer>
          </div>
          <div className="flex justify-center gap-8 mt-4">
             <div className="text-center">
                <p className="text-2xl font-bold text-slate-800">2.8x</p>
                <p className="text-xs text-slate-500">Max Gain on H100</p>
             </div>
             <div className="text-center">
                <p className="text-2xl font-bold text-blue-700">4.0x</p>
                <p className="text-xs text-slate-500">Max Gain on A40</p>
             </div>
          </div>
        </div>
      );

      // --- Main Component ---
      const App = () => {
        const [mounted, setMounted] = useState(false);
        useEffect(() => setMounted(true), []);

        if (!mounted) return null;

        return (
          <div className="min-h-screen bg-slate-50 font-sans text-slate-800 leading-relaxed">
            <div className="max-w-3xl mx-auto bg-white min-h-screen shadow-lg border-x border-slate-100">
              
              {/* Header */}
              <header className="pt-16 pb-8 px-8 md:px-12">
                <div className="flex gap-3 mb-6">
                  <span className="px-3 py-1 bg-blue-100 text-blue-700 text-xs font-bold uppercase tracking-wide rounded-full">ML Systems</span>
                  <span className="px-3 py-1 bg-purple-100 text-purple-700 text-xs font-bold uppercase tracking-wide rounded-full">Research</span>
                </div>
                <h1 className="text-4xl md:text-5xl font-extrabold mb-6 text-slate-900 tracking-tight leading-tight">
                  Vortex: Democratizing <br/>
                  <span className="text-blue-600">Sparse Attention</span>
                </h1>
                
                <div className="flex items-center gap-6 text-sm text-slate-500 border-b border-slate-100 pb-8">
                  <div className="flex items-center gap-2">
                    <div className="w-8 h-8 bg-slate-200 rounded-full flex items-center justify-center">
                      <Icon name="User" className="w-4 h-4 text-slate-500" />
                    </div>
                    <span className="font-medium text-slate-900">System Research</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <Icon name="Clock" className="w-4 h-4" />
                    <span>6 min read</span>
                  </div>
                </div>
              </header>

              <main className="px-8 md:px-12 pb-20">
                
                {/* Motivation */}
                <SectionHeader title="1. Motivation" />
                <p className="text-lg text-slate-700 mb-6">
                  The rise of sparse attention models, such as DeepSeek DSA, MoBA, and NSA, coupled with dramatic cost reductions and performance gains, underscores the need to develop these techniques.
                </p>
                <p className="text-slate-700 mb-6">
                  However, a disconnect exists. ML developers introduce algorithms that never reach production, while system developers are forced into an unavoidable trade-off.
                </p>

                <SystemDilemma />

                <p className="text-slate-700 mb-6 italic border-l-4 border-blue-500 pl-4 py-2 bg-slate-50">
                  "Progress slows not because the ideas aren’t good, but because making them run in scale is exhausting."
                </p>

                {/* AI Agents Section */}
                <Callout title="The AI Agent Paradox" type="warning">
                  <p className="mb-4">
                    In theory, AI-powered code agents should be the perfect practitioners—intelligent enough to extract algorithms and write kernels.
                  </p>
                  <p className="font-bold text-slate-800">But here is the painful truth:</p>
                  <p>
                    Because modern serving systems are so complex, code agents have almost no chance of implementing new algorithms directly. Questions like "How is KV memory managed?" or "What is the exact shape of each tensor?" are too opaque for them to answer reliably.
                  </p>
                </Callout>

                {/* Ideal Framework */}
                <SectionHeader title="2. What is an ideal framework?" />
                <p className="text-slate-700 mb-6">
                  A helpful analogy comes from the evolution of Deep Learning. <strong>PyTorch</strong> succeeded because it separated concerns:
                </p>
                <ul className="list-disc pl-6 mb-6 space-y-2 text-slate-700">
                  <li><strong>Frontend:</strong> Simple, Pythonic interface for researchers.</li>
                  <li><strong>System Layer:</strong> Computational graph engine for heavy lifting.</li>
                  <li><strong>Hardware:</strong> Seamless deployment across CPUs, GPUs, TPUs.</li>
                </ul>
                <p className="text-slate-700">
                  Sparse attention deserves the same kind of ecosystem. A place where AI agents can excel at constructing networks and writing kernels without fighting the infrastructure.
                </p>

                {/* Challenges */}
                <SectionHeader title="3. Core Challenges" />
                <p className="text-slate-700 mb-6">
                  Even in simple prototypes, three fundamental challenges appear immediately:
                </p>
                <CoreChallenges />

                {/* Vortex Solution */}
                <SectionHeader title="4. Vortex" />
                <p className="text-slate-700 mb-6">
                  Vortex is the bridge. It lets developers write sparse attention like standard PyTorch, yet gives serving systems the structure they need to execute efficiently.
                </p>

                <h3 className="font-bold text-lg text-slate-900 mt-8 mb-4">4.1 Two-Phase Frontend</h3>
                <p className="text-slate-700 mb-6">
                  Vortex introduces two entry points that map cleanly to serving system components:
                </p>
                
                <VortexArchitectureDiagram />

                <h3 className="font-bold text-lg text-slate-900 mt-8 mb-4">4.2 One Tensor Interface, Many Backends</h3>
                <p className="text-slate-700 mb-6">
                   To manage layout complexity (Flat, Ragged, Paged), Vortex extends the tensor abstraction.
                </p>

                <TensorInterfaceVisual />

                <h3 className="font-bold text-lg text-slate-900 mt-8 mb-4">4.3 Built to Reuse Infrastructure</h3>
                <p className="text-slate-700 mb-6">
                  Vortex doesn't reinvent the wheel. It reuses the core infrastructure of modern LLM serving systems. If FlashAttention upgrades to v3, Vortex inherits the speedup immediately.
                </p>

                {/* Applications */}
                <SectionHeader title="5. Applications" />
                <p className="text-slate-700 mb-6">
                  With Vortex, sparse-attention research moves from toy settings to real deployments. The system delivers substantial throughput gains without model-specific engineering.
                </p>

                <PerformanceChart />

                <div className="mt-10 p-8 bg-blue-50 rounded-2xl border border-blue-100 text-center">
                  <h3 className="text-xl font-bold text-blue-900 mb-2">Ready to Scale?</h3>
                  <p className="text-blue-700 leading-relaxed">
                    By providing a unified framework that bridges algorithms and serving infrastructure, Vortex opens the door to research and applications that truly scale.
                  </p>
                </div>

              </main>
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);

    } catch (err) {
      document.body.innerHTML = `
        <div style="color: #ef4444; padding: 20px; font-family: sans-serif; text-align: center;">
          <h2 style="font-weight: bold; margin-bottom: 10px;">Rendering Error</h2>
          <pre style="background: #fee2e2; padding: 10px; border-radius: 4px; overflow: auto;">${err.message}</pre>
        </div>
      `;
      console.error(err);
    }
  </script>
</body>
</html>